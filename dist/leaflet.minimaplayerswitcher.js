/*
	Leaflet.MiniMapLayers, a plugin that makes layer switching sexy.
	(c) 2013, Andrew Beaven, Smartrak

	http://leafletjs.com
*/!function(){L.miniMapLayerSwitcherVersion="0.1-dev",L.Control.MiniMapLayerSwitcher=L.Control.extend({_className:"leaflet-mini-map-control-layers",options:{miniMapLabelHeight:22,miniMapHeight:80,miniMapWidth:90,miniMapMargin:10,miniMapZoomOffset:-3,position:"topright",autoZIndex:!0},initialize:function(i,t){L.setOptions(this,t),this._layers=[],this._miniMaps={},this._lastZIndex=0;for(var a in i)this._addLayer(i[a],a)},addTo:function(i){var t=this;return L.Control.prototype.addTo.call(this,i),this._updateMiniMaps(),this._forEachLayer(function(i){var a=i.id,e=t._miniMaps[a];e.invalidateSize()}),this},onAdd:function(){return this._map.on("move",this._updateMiniMaps,this).whenReady(this._onMapReady,this),this._render(),this._container},onRemove:function(){this._map.off("move",this._updateMiniMaps,this)},_render:function(){var i,t,a=this._container=L.DomUtil.create("div",this._className),e=this._inner=L.DomUtil.create("div",this._className+"-inner");return a.setAttribute("aria-haspopup",!0),L.DomEvent.disableClickPropagation(a),L.Browser.touch?L.DomEvent.on(a,"click",this._toggleMiniMaps,this):L.DomEvent.on(a,"mousewheel",L.DomEvent.stopPropagation).on(a,"mouseenter",this._expand,this).on(a,"mouseleave",this._contract,this),a.style.height=this.options.miniMapHeight+this.options.miniMapLabelHeight+"px",a.appendChild(e),this._forEachLayer(function(i){this._renderMiniMap(i,e)},this),this._hasMultipleLayers()?(i=this._getInitialMainMapLayerId(),t=this._getInitialMiniMapLayerId(i),this._activeLayerId=t,this._switchLayer(i),void 0):(this._container.style.display="none",void 0)},_toggleMiniMaps:function(){var i=L.DomUtil.hasClass(this._container,"expanded");this._animateMiniMaps(!i)},_expand:function(){this._animateMiniMaps(!0)},_contract:function(){this._animateMiniMaps(!1)},_renderMiniMap:function(i,t){var a=this._mapContainer=L.DomUtil.create("div","map-container"),e=L.DomUtil.create("div","map-container-inner"),n=this._mapContainer=L.DomUtil.create("div","map"),s=L.DomUtil.create("div","map-label"),o=i.id,r=this._findLayer(o);L.DomEvent.on(a,"click",this._onMiniMapClicked,this),n.style.height=this.options.miniMapHeight+"px",n.style.width=this.options.miniMapWidth+"px",s.innerHTML=i.name,e.appendChild(n),e.appendChild(s),a.layerId=o,a.style.width=this.options.miniMapWidth+"px",a.appendChild(e),t.appendChild(a),this._addMiniMap(o,r.miniMapLayer,n)},_addMiniMap:function(i,t,a){var e=this.options.miniMapZoomOffset,n=this._map.getMinZoom(),s=this._map.getMaxZoom(),o=L.map(a,{dragging:!1,touchZoom:!1,scrollWheelZoom:!1,doubleClickZoom:!1,boxZoom:!1,trackResize:!1,attributionControl:!1,zoomControl:!1,inertia:!1,worldCopyJump:!1,layers:[t],minZoom:n+e,maxZoom:s+e});this._miniMaps[i]=o},_addLayer:function(i,t){var a,e,n,s=L.stamp(i);if(i instanceof L.LayerGroup){e=new L.LayerGroup;for(a in i._layers)n=i._layers[a],n instanceof L.TileLayer&&e.addLayer(new L.TileLayer(n._url,n.options))}else e=new L.TileLayer(i._url,i.options);this._layers.push({id:s,name:t,mainMapLayer:i,miniMapLayer:e}),this.options.autoZIndex&&i.setZIndex&&(this._lastZIndex++,i.setZIndex(this._lastZIndex))},_findLayer:function(i){var t,a,e=this._layers,n=e.length;for(t=0;n>t;t++)if(a=e[t],a.id===i)return a;return null},_getCurrentTarget:function(i){return i.currentTarget?i.currentTarget:this._getFirstElementWithClass(i.srcElement,"map-container")},_getFirstElementWithClass:function(i,t){var a=L.DomUtil.hasClass(i,t),e=i.parentNode;return a?i:this._getFirstElementWithClass(e,t)},_onMiniMapClicked:function(i){var t,a=this._container,e=this._getCurrentTarget(i),n=e.layerId,s=L.DomUtil.hasClass(this._container,"expanded");s&&n!==this._activeLayerId&&(t=this._findLayer(n),L.DomUtil.addClass(a,"notransition"),this._switchLayer(n),this._map.fire("baselayerchanged",t.mainMapLayer),L.Util.falseFn(e.offsetWidth),L.DomUtil.removeClass(a,"notransition"))},_switchLayer:function(i){var t,a,e,n=this._activeLayerId,s=this._findLayer(n),o=this._findLayer(i),r=this._getMiniMapContainer(i);this._moveLayerToBack(o),a=this._layers[0].id,e=this._getMiniMapContainer(a),this._suggestedLayerId=a,this._activeLayerId=i,this._forEachLayer(function(i){t=this._getMiniMapContainer(i.id),L.DomUtil.removeClass(t,"active-map"),L.DomUtil.removeClass(t,"suggested-map")}),L.DomUtil.addClass(r,"active-map"),L.DomUtil.addClass(e,"suggested-map"),this._map.removeLayer(s.mainMapLayer),this._map.addLayer(o.mainMapLayer)},_moveLayerToBack:function(i){var t,a=i.id,e=this._layers,n=e.length;for(t=0;n>t;t++)if(e[t].id===a){i=e.splice(t,1)[0],e.push(i);break}},_animateMiniMaps:function(i){var t,a,e=0,n=this.options.miniMapWidth,s=this.options.miniMapMargin,o=this._container,r=L.DomUtil.hasClass(o,"expanded");r!==i&&(this._forEachLayer(function(o){a=o.id,t=this._getMiniMapContainer(a),this._updateMiniMapPosition(a),i?(t.style.left=e*(n+s)+"px",e++):t.style.left="0"}),i?(o.style.width=e*(n+s)-s+"px",L.DomUtil.addClass(o,"expanded")):(o.style.width="0",L.DomUtil.removeClass(o,"expanded")))},_getInitialMainMapLayerId:function(){var i,t;return this._forEachLayer(function(a){return i=a.mainMapLayer,this._map.hasLayer(i)?(t=a.id,!1):void 0}),t?t:(this._forEachLayer(function(i){return t=i.id,!1}),t)},_getInitialMiniMapLayerId:function(i){var t,a;return this._forEachLayer(function(e){return t=e.id,t!==i?(a=t,!1):void 0}),a},_forEachLayer:function(i){var t,a,e=this._layers,n=e.length;for(a=0;n>a&&(t=e[a],i.call(this,t)!==!1);a++);},_getMiniMapContainer:function(i){var t=this._miniMaps[i];return t.getContainer().parentNode.parentNode},_updateMiniMaps:function(){var i=this._suggestedLayerId,t=L.DomUtil.hasClass(this._container,"expanded");t?this._forEachLayer(function(i){this._updateMiniMapPosition(i.id)},this):this._updateMiniMapPosition(i)},_updateMiniMapPosition:function(i){var t,a,e,n;this._mainMapReady&&this._hasMultipleLayers()&&(t=this._map,a=t.getCenter(),e=t.getZoom()+this.options.miniMapZoomOffset,n=this._miniMaps[i],n.setView(a,e,{pan:{animate:!1},zoom:{animate:!0}}))},_onMapReady:function(){this._mainMapReady=!0},_hasMultipleLayers:function(){return this._layers.length>0}}),L.control.miniMapLayerSwitcher=function(i,t){return new L.Control.MiniMapLayerSwitcher(i,t)}}();